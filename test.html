<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>lumino-easy - ESM Test</title>
    <style>
      html,
      body {
        margin: 0;
        padding: 0;
        height: 100%;
        width: 100%;
        overflow: hidden;
        font-family: system-ui, sans-serif;
      }
      #dock {
        height: 100%;
        width: 100%;
      }
    </style>
  </head>
  <body>
    <div id="dock"></div>

    <script type="module">
      import { Docker, Widget } from "./dist/lumino-easy.es.js";

      const dock = new Docker({
        widgets: {
          EDITOR: (cfg) =>
            Widget.create({
              ...cfg,
              kind: "EDITOR",
              render: (ctx) =>
                `<div style="padding: 20px; color: #ccc;"><h2>${ctx.label}</h2></div>`,
            }),
        },
        // onTabAdded: (config) => console.log("[tab added]", config),
        onTabRemoved: (config) => console.log("[tab removed]", config.view.id),
        onTabAdded: (config) => {
          Widget.closer(config, ({ el, setDirty, isDirty }) => {
            // Update icon based on dirty state
            const updateIcon = () => {
              if (isDirty()) {
                el.textContent = "●";
                el.style.fontSize = "36px";
                el.style.marginTop = "-6px";
              } else {
                el.textContent = "×"; // `X`  or `×`
                el.style.fontSize = "26px";
                el.style.marginTop = "-3px";
              }
            };
            if (config.tab.dataset.id === "file-1") setDirty(true);
            // Initial render
            updateIcon();

            // Click handler
            return () => {
              if (isDirty()) {
                if (confirm("Unsaved changes. Close anyway?")) {
                  setDirty(false);
                  console.log("CLOSE (forced)");
                }
              } else {
                console.log("CLOSE");
              }
            };
          });
          console.log("[tab added]", config.tab.dataset.id);
        },
      });

      // Attach to DOM
      dock.attach(document.getElementById("dock"));

      // Create widgets
      const widget1 = dock.widget("EDITOR", {
        id: "file-1",
        label: "index.js",
        closable: true,
      });
      const widget2 = dock.widget("EDITOR", {
        id: "file-2",
        label: "style.css",
        closable: true,
      });

      // Add widgets
      dock.add(widget1);
      dock.add(widget2, { mode: "split-right", ref: widget1 });

      // Handle resize
      window.addEventListener("resize", () => dock.update());

      console.log("Docker initialized!", dock);
    </script>
  </body>
</html>
